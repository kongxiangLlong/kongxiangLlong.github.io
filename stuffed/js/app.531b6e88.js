(function(e){function t(t){for(var i,a,l=t[0],r=t[1],h=t[2],d=0,u=[];d<l.length;d++)a=l[d],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&u.push(n[a][0]),n[a]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);c&&c(t);while(u.length)u.shift()();return s.push.apply(s,h||[]),o()}function o(){for(var e,t=0;t<s.length;t++){for(var o=s[t],i=!0,l=1;l<o.length;l++){var r=o[l];0!==n[r]&&(i=!1)}i&&(s.splice(t--,1),e=a(a.s=o[0]))}return e}var i={},n={app:0},s=[];function a(t){if(i[t])return i[t].exports;var o=i[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=i,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(o,i,function(t){return e[t]}.bind(null,i));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],r=l.push.bind(l);l.push=t,l=l.slice();for(var h=0;h<l.length;h++)t(l[h]);var c=r;s.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"034f":function(e,t,o){"use strict";var i=o("85ec"),n=o.n(i);n.a},"56d7":function(e,t,o){"use strict";o.r(t);o("e260"),o("e6cf"),o("cca6"),o("a79d");var i=o("2b0e"),n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("i",{staticClass:"el-icon-menu",attrs:{id:"c"},on:{click:function(t){e.drawer=!e.drawer}}}),o("a",{staticClass:"link",attrs:{target:"blank",href:"https://wenku.baidu.com/view/d4b289a7b0717fd5360cdc56.html"}},[e._v("https://wenku.baidu.com/view/d4b289a7b0717fd5360cdc56.html")]),o("maincanvas",{attrs:{display:e.display}}),o("el-drawer",{attrs:{title:"数据",visible:e.drawer,size:"600px",direction:"rtl"},on:{"update:visible":function(t){e.drawer=t}}},[o("div",{staticStyle:{"text-align":"right",padding:"0px 20px 10px 0px"}},[o("el-button",{attrs:{type:"primary",disabled:!e.hasSelect},on:{click:e.doitClick}},[e._v("do it")])],1),o("el-collapse",[o("el-collapse-item",{attrs:{name:"1"}},[o("template",{slot:"title"},[o("div",{staticClass:"collapse_title"},[e._v("货物 "),o("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.showAddGoodsDialog(t)}}})])]),o("el-table",{ref:"goodstable",staticStyle:{width:"100%"},attrs:{size:"mini",border:"",data:this.opt.goods,type:"index"},on:{"row-dblclick":e.goodsrowdbclick,"selection-change":e.handleSelectionChange_goods}},[o("el-table-column",{attrs:{type:"selection",width:"40"}}),o("el-table-column",{attrs:{prop:"name",label:"名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.name)+" ")]}}])}),o("el-table-column",{attrs:{prop:"color",label:"颜色",width:"60px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[o("div",{staticClass:"colorcell",style:{"background-color":e.row.color}})]}}])}),o("el-table-column",{attrs:{label:"长宽高"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.length)+"*"+e._s(t.row.width)+"*"+e._s(t.row.height)+" ")]}}])}),o("el-table-column",{attrs:{prop:"num",label:"数量"}}),o("el-table-column",{attrs:{prop:"inout",label:"先进先出"}}),o("el-table-column",{attrs:{label:"操作",width:"60px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("i",{staticClass:"el-icon-delete",on:{click:function(o){return e.goodsdel(t.$index)}}})]}}])})],1)],2),o("el-collapse-item",{attrs:{name:"2"}},[o("template",{slot:"title"},[o("div",{staticClass:"collapse_title"},[e._v("集装箱 "),o("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.showAddboxesDialog(t)}}})])]),o("el-table",{ref:"boxestable",staticStyle:{width:"100%"},attrs:{size:"mini",border:"",data:this.opt.boxes,type:"index"},on:{"row-dblclick":e.boxesrowdbclick,"selection-change":e.handleSelectionChange_boxes}},[o("el-table-column",{attrs:{type:"selection",width:"40"}}),o("el-table-column",{attrs:{prop:"name",label:"名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.name)+" ")]}}])}),o("el-table-column",{attrs:{label:"长宽高"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.length)+"*"+e._s(t.row.width)+"*"+e._s(t.row.height)+" ")]}}])}),o("el-table-column",{attrs:{label:"操作",width:"60px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("i",{staticClass:"el-icon-delete",on:{click:function(o){return e.boxesdel(t.$index)}}})]}}])})],1)],2)],1)],1),o("el-dialog",{attrs:{"close-on-click-modal":!1,title:"添加货物",visible:e.dialog.goodsshow,width:"700px"},on:{"update:visible":function(t){return e.$set(e.dialog,"goodsshow",t)}}},[o("div",{staticClass:"diagloggood"},[o("goodcanvas",{attrs:{good:e.dialog.goodform}})],1),o("el-form",{ref:"goodform",attrs:{inline:!0,size:"mini","label-position":"left",model:e.dialog.goodform,rules:e.dialog.goodformrules}},[o("div",[o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{staticStyle:{width:"150px"},model:{value:e.dialog.goodform.name,callback:function(t){e.$set(e.dialog.goodform,"name",t)},expression:"dialog.goodform.name"}})],1),o("el-form-item",{staticStyle:{"padding-left":"20px"},attrs:{label:"颜色"}},[o("colorPicker",{model:{value:e.dialog.goodform.color,callback:function(t){e.$set(e.dialog.goodform,"color",t)},expression:"dialog.goodform.color"}})],1)],1),o("el-form-item",{attrs:{label:"重量"}},[o("el-input",{staticStyle:{"text-align":"center",width:"80px"},model:{value:e.dialog.goodform.grossweight,callback:function(t){e.$set(e.dialog.goodform,"grossweight",e._n(t))},expression:"dialog.goodform.grossweight"}})],1),o("el-form-item",{attrs:{label:"数量",prop:"num"}},[o("el-input-number",{staticStyle:{width:"100px"},attrs:{step:20,min:1},model:{value:e.dialog.goodform.num,callback:function(t){e.$set(e.dialog.goodform,"num",t)},expression:"dialog.goodform.num"}})],1),o("el-form-item",{attrs:{label:"描述"}},[o("el-input",{staticStyle:{width:"350px"},attrs:{autosize:""},model:{value:e.dialog.goodform.desc,callback:function(t){e.$set(e.dialog.goodform,"desc",t)},expression:"dialog.goodform.desc"}})],1),o("el-form-item",{attrs:{label:"先进先出级别(1为最先出放外面)"}},[o("el-input-number",{staticStyle:{width:"100px"},attrs:{step:1,min:0},model:{value:e.dialog.goodform.inout,callback:function(t){e.$set(e.dialog.goodform,"inout",t)},expression:"dialog.goodform.inout"}})],1),o("el-tabs",{model:{value:e.dialog.tabval,callback:function(t){e.$set(e.dialog,"tabval",t)},expression:"dialog.tabval"}},[o("el-tab-pane",{attrs:{label:"尺寸",name:"1"}},[o("div",[o("el-form-item",{attrs:{label:"长",prop:"length"}},[o("el-input-number",{staticStyle:{width:"100px"},attrs:{step:20,min:1},model:{value:e.dialog.goodform.length,callback:function(t){e.$set(e.dialog.goodform,"length",t)},expression:"dialog.goodform.length"}})],1)],1),o("div",[o("el-form-item",{attrs:{label:"宽",prop:"width"}},[o("el-input-number",{staticStyle:{width:"100px"},attrs:{step:20,min:1},model:{value:e.dialog.goodform.width,callback:function(t){e.$set(e.dialog.goodform,"width",t)},expression:"dialog.goodform.width"}})],1)],1),o("div",[o("el-form-item",{attrs:{label:"高",prop:"height"}},[o("el-input-number",{staticStyle:{width:"100px"},attrs:{step:20,min:1},model:{value:e.dialog.goodform.height,callback:function(t){e.$set(e.dialog.goodform,"height",t)},expression:"dialog.goodform.height"}})],1)],1)]),o("el-tab-pane",{attrs:{label:"摆放限制",name:"2"}},[o("el-table",{staticStyle:{width:"100%"},attrs:{size:"mini","highlight-current-row":"",data:e.dialog.goodform.restrictions},on:{"current-change":e.handleCurrentChange}},[o("el-table-column",{attrs:{label:"摆放方向",width:"130",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-checkbox",{attrs:{size:"mini"},model:{value:t.row.isselect,callback:function(o){e.$set(t.row,"isselect",o)},expression:"scope.row.isselect"}},[e._v(e._s(t.row.direction))])]}}])}),o("el-table-column",{attrs:{label:"是否承重面",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-checkbox",{attrs:{size:"mini"},model:{value:t.row.isbear,callback:function(o){e.$set(t.row,"isbear",o)},expression:"scope.row.isbear"}})]}}])}),o("el-table-column",{attrs:{label:"承托级别",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},model:{value:t.row.bearlevel,callback:function(o){e.$set(t.row,"bearlevel",e._n(o))},expression:"scope.row.bearlevel"}})]}}])}),o("el-table-column",{attrs:{label:"自身堆码限制",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-checkbox",{attrs:{size:"mini"},model:{value:t.row.isstack,callback:function(o){e.$set(t.row,"isstack",o)},expression:"scope.row.isstack"}})]}}])}),o("el-table-column",{attrs:{label:"自身最大堆码层数"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},model:{value:t.row.stacklevel,callback:function(o){e.$set(t.row,"stacklevel",e._n(o))},expression:"scope.row.stacklevel"}})]}}])})],1)],1)],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialog.goodsshow=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.saveGood}},[e._v("确 定")])],1)],1),o("el-dialog",{attrs:{"close-on-click-modal":!1,title:"添加集装箱",visible:e.dialog.boxesshow,width:"700px"},on:{"update:visible":function(t){return e.$set(e.dialog,"boxesshow",t)}}},[o("el-form",{ref:"boxform",attrs:{inline:!0,size:"mini","label-position":"left",model:e.dialog.boxform,rules:e.dialog.boxformrules}},[o("div",[o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{staticStyle:{width:"150px"},model:{value:e.dialog.boxform.name,callback:function(t){e.$set(e.dialog.boxform,"name",t)},expression:"dialog.boxform.name"}})],1)],1),o("div",[o("el-form-item",{attrs:{label:"描述"}},[o("el-input",{staticStyle:{width:"350px"},attrs:{autosize:""},model:{value:e.dialog.boxform.desc,callback:function(t){e.$set(e.dialog.boxform,"desc",t)},expression:"dialog.boxform.desc"}})],1)],1),o("div",[o("el-form-item",{attrs:{label:"长",prop:"length"}},[o("el-input-number",{staticStyle:{width:"200px"},attrs:{step:200,min:1},model:{value:e.dialog.boxform.length,callback:function(t){e.$set(e.dialog.boxform,"length",t)},expression:"dialog.boxform.length"}})],1)],1),o("div",[o("el-form-item",{attrs:{label:"宽",prop:"width"}},[o("el-input-number",{staticStyle:{width:"200px"},attrs:{step:200,min:1},model:{value:e.dialog.boxform.width,callback:function(t){e.$set(e.dialog.boxform,"width",t)},expression:"dialog.boxform.width"}})],1)],1),o("div",[o("el-form-item",{attrs:{label:"高",prop:"height"}},[o("el-input-number",{staticStyle:{width:"200px"},attrs:{step:200,min:1},model:{value:e.dialog.boxform.height,callback:function(t){e.$set(e.dialog.boxform,"height",t)},expression:"dialog.boxform.height"}})],1)],1)]),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialog.boxesshow=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.saveBox}},[e._v("确 定")])],1)],1)],1)},s=[],a=(o("4de4"),o("fb6a"),o("a434"),o("b0c0"),o("d3b7"),o("25f0"),function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{ref:"canvas",attrs:{id:"maincanvas"}},[o("el-slider",{attrs:{vertical:"","show-input":""},model:{value:e.cameraOpt.fov,callback:function(t){e.$set(e.cameraOpt,"fov",t)},expression:"cameraOpt.fov"}})],1)}),l=[],r=(o("4160"),o("159b"),o("5a89")),h=o("a550");h["a"].install({THREE:r});var c={name:"maincanvas",props:{display:{type:Object,default:function(){return{box:{length:3e3,width:100,height:100},color:"#FF0000",length:100,width:100,height:100}}}},data:function(){return{_display:null,canvas:{width:null,height:null},scene:null,renderer:null,camera:null,cameraOpt:{fov:45,near:1,far:1e5},light:null,clock:null,cameraControls:null,vv:"",boxGroup:null,goodsGroups:[],raycaster:null,mouseVector:null,selectedObject:null,selectedObjectColorTemp:null}},computed:{displayInfo:function(){return this.display?this.display:{box:{length:8e3,width:2200,height:2200}}}},watch:{display:{handler:function(){this.generateBoxGroup(),this.generateGoodsGroups()},deep:!0}},created:function(){var e=this;this.$nextTick((function(){e.threeStart()}))},mounted:function(){window.addEventListener("resize",this.onWindowResize),this.$refs.canvas.addEventListener("mousemove",this.onDocumentMouseMove,!1),this.$refs.canvas.addEventListener("dblclick",this.onDblClick,!1),this.$refs.canvas.addEventListener("mousedown",this.onDocumentMouseDown,!1)},methods:{initThree:function(){this.canvas.width=this.$refs.canvas.clientWidth,this.canvas.height=this.$refs.canvas.clientHeight,this.renderer=new r["WebGLRenderer"]({antialias:!0}),this.renderer.setSize(this.canvas.width,this.canvas.height),this.$refs.canvas.appendChild(this.renderer.domElement),this.renderer.setClearColor(16777215,1)},initScene:function(){this.scene=new r["Scene"],this.raycaster=new r["Raycaster"],this.mouseVector=new r["Vector3"]},initCamera:function(){this.camera=new r["PerspectiveCamera"](this.cameraOpt.fov,this.canvas.width/this.canvas.height,this.cameraOpt.near,this.cameraOpt.far),this.camera.position.x=3300,this.camera.position.y=3e3,this.camera.position.z=1e4,this.camera.lookAt({x:0,y:50,z:0})},initClockAndCameraControls:function(){this.clock=new r["Clock"],this.cameraControls=new h["a"](this.camera,this.renderer.domElement)},initLight:function(){var e=new r["AmbientLight"](0,1);this.scene.add(e);var t=[];t[0]=new r["PointLight"](15658734,1,0,6),t[1]=new r["PointLight"](15658734,1,0,6),t[2]=new r["PointLight"](15658734,1,0,6),t[0].position.set(3e3,5e3,3e3),t[1].position.set(7e3,5e3,1e4),t[2].position.set(-5e3,-5e3,-3e3),this.scene.add(t[0]),this.scene.add(t[1]),this.scene.add(t[2])},initObject:function(){this.generateBoxGroup()},animation:function(){var e=this.clock.getDelta();this.cameraControls.update(e),this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animation)},threeStart:function(){this.initThree(),this.initCamera(),this.initClockAndCameraControls(),this.initScene(),this.initLight(),this.initObject(),this.animation()},center:function(){var e=new r["BoxGeometry"](1,1,1),t=new r["MeshBasicMaterial"]({color:8947848}),o=new r["Mesh"](e,t);this.scene.add(o)},horizontal:function(){var e=6e3,t=50,o=new r["GridHelper"](e,t,1192387,1265971);this.scene.add(o)},getGoodInitialPostion:function(){return{x:-this.displayInfo.box.width/2+5,y:-this.displayInfo.box.height/2+5,z:-this.displayInfo.box.length/2+5}},generateBoxGroup:function(){null!=this.boxGroup&&(this.scene.remove(this.boxGroup),this.boxGroup=null),this.boxGroup=new r["Group"];var e=new r["MeshPhongMaterial"]({color:12475237,side:r["DoubleSide"],flatShading:r["FlatShading"]}),t=new r["Group"],o=new r["CubeGeometry"](1,this.displayInfo.box.height,this.displayInfo.box.length),i=new r["Mesh"](o,e),n=new r["LineSegments"](o,new r["LineBasicMaterial"]({color:0}));t.add(i,n),t.position.x=-this.displayInfo.box.width/2,t.position.y=0,t.position.z=0;var s=new r["Group"],a=new r["CubeGeometry"](this.displayInfo.box.width,1,this.displayInfo.box.length),l=new r["Mesh"](a,e),h=new r["LineSegments"](a,new r["LineBasicMaterial"]({color:0}));s.add(l,h),s.position.x=0,s.position.y=-this.displayInfo.box.height/2,s.position.z=0;var c=new r["Group"],d=new r["CubeGeometry"](this.displayInfo.box.width,this.displayInfo.box.height,1),u=new r["Mesh"](d,e),g=new r["LineSegments"](d,new r["LineBasicMaterial"]({color:0}));c.add(u,g),c.position.x=0,c.position.y=0,c.position.z=-this.displayInfo.box.length/2,this.boxGroup.add(t),this.boxGroup.add(s),this.boxGroup.add(c),this.scene.add(this.boxGroup)},generateGoodsGroups:function(){var e=this;null!=this.goodsGroups&&this.goodsGroups.length>0&&(this.goodsGroups.forEach((function(t){e.scene.remove(t)})),this.goodsGroups=[]);var t=this.getGoodInitialPostion();this.displayInfo.goodsManager.realGoods.forEach((function(o){if(o.pos){var i=new r["Group"],n=new r["CubeGeometry"](o.width,o.height,o.length),s=new r["MeshPhongMaterial"]({color:o.color,side:r["DoubleSide"],flatShading:r["FlatShading"]}),a=new r["Mesh"](n,s),l=new r["Line"](n,new r["LineDashedMaterial"]({color:0}));i.add(a,l),i.position.x=t.x+o.width/2+o.pos.x,i.position.y=t.y+o.height/2+o.pos.y,i.position.z=t.z+o.length/2+o.pos.z,i.userData=o,e.goodsGroups.push(i),e.scene.add(i)}})),this.otherboxShow()},otherboxShow:function(){var e=this,t=this.getGoodInitialPostion();this.displayInfo.otherbox.forEach((function(o){if(o.pos&&!o.isFalse){var i=new r["Group"],n=new r["CubeGeometry"](o.width,o.height,o.length),s=new r["MeshPhongMaterial"]({color:"#ffffff",side:r["DoubleSide"],flatShading:r["FlatShading"]});o.isBWOK&&s.color.set("#000000");var a=new r["Mesh"](n,s),l=new r["Line"](n,new r["LineDashedMaterial"]({color:0}));i.add(a,l),i.position.x=t.x+o.width/2+o.pos.x,i.position.y=t.y+o.height/2+o.pos.y,i.position.z=t.z+o.length/2+o.pos.z,i.userData=o,e.goodsGroups.push(i),e.scene.add(i)}}))},onWindowResize:function(){this.$refs.canvas&&(this.canvas.width=this.$refs.canvas.clientWidth,this.canvas.height=this.$refs.canvas.clientHeight,this.camera.aspect=this.canvas.width/this.canvas.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.canvas.width,this.canvas.height))},onDocumentMouseMove:function(e){e.preventDefault(),this.selectedObject&&(this.selectedObject.material.color.set(this.selectedObjectColorTemp),this.selectedObject=null);var t=this.getIntersects(e.layerX,e.layerY);if(t.length>0&&this.selectedObject!=t[0].object){var o=t.filter((function(e){return e&&e.object}))[0];o&&o.object&&(this.selectedObject=o.object,this.selectedObjectColorTemp="#"+this.selectedObject.material.color.getHexString(),this.selectedObject.material.color.set("#69f"))}},onDblClick:function(e){e.preventDefault();var t=this.getIntersects(e.layerX,e.layerY);if(t.length>0){var o=t.filter((function(e){return e&&e.object}))[0];o&&o.object&&(console.log(o.object.parent.parent.userData),console.log(o.object.parent.userData),this.scene.remove(o.object.parent.parent),this.scene.remove(o.object.parent))}},onDocumentMouseDown:function(e){e.preventDefault();var t=this.getIntersects(e.layerX,e.layerY);if(t.length>0){var o=t.filter((function(e){return e&&e.object}))[0];o&&o.object&&console.log(o.object.parent.userData)}},getIntersects:function(e,t){return e=e/window.innerWidth*2-1,t=-t/window.innerHeight*2+1,this.mouseVector.set(e,t,.5),this.raycaster.setFromCamera(this.mouseVector,this.camera),this.raycaster.intersectObject(this.scene,!0)}}},d=c,u=o("2877"),g=Object(u["a"])(d,a,l,!1,null,null,null),p=g.exports,f=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{ref:"canvas",attrs:{id:"goodcanvas"}})},m=[];h["a"].install({THREE:r});var b={name:"goodcanvas",props:{good:{type:Object,default:function(){return{color:"#FF0000",length:100,width:100,height:100}}}},watch:{"good.color":function(){this.addGeometry()},"good.length":function(){this.addGeometry()},"good.width":function(){this.addGeometry()},"good.height":function(){this.addGeometry()},"good.restrictionflag":function(){this.changeRotation()}},data:function(){return{canvas:{width:null,height:null},scene:null,renderer:null,camera:null,cameraOpt:{fov:45,near:1,far:1e4},light:null,group:null,vv:""}},created:function(){var e=this;this.$nextTick((function(){e.threeStart()}))},methods:{initThree:function(){this.canvas.width=this.$refs.canvas.clientWidth,this.canvas.height=this.$refs.canvas.clientHeight,this.renderer=new r["WebGLRenderer"]({antialias:!0}),this.renderer.setSize(this.canvas.width,this.canvas.height),this.$refs.canvas.appendChild(this.renderer.domElement),this.renderer.setClearColor(16777215,1)},initScene:function(){this.scene=new r["Scene"]},initCamera:function(){this.camera=new r["PerspectiveCamera"](this.cameraOpt.fov,this.canvas.width/this.canvas.height,this.cameraOpt.near,this.cameraOpt.far),this.camera.position.x=100,this.camera.position.y=60,this.camera.position.z=90,this.camera.lookAt({x:0,y:50,z:0})},initClockAndCameraControls:function(){this.clock=new r["Clock"],this.cameraControls=new h["a"](this.camera,this.renderer.domElement)},initLight:function(){var e=new r["AmbientLight"](15658734,1);this.scene.add(e)},animation:function(){this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animation)},threeStart:function(){this.initThree(),this.initCamera(),this.initClockAndCameraControls(),this.initScene(),this.initLight(),this.addGeometry(),this.center(),this.animation()},center:function(){var e=new r["BoxGeometry"](.01,.01,.01),t=new r["MeshBasicMaterial"]({color:8947848}),o=new r["Mesh"](e,t);this.scene.add(o)},horizontal:function(){var e=6e3,t=50,o=new r["GridHelper"](e,t,1192387,1265971);this.scene.add(o)},addGeometry:function(){null!=this.group&&(this.scene.remove(this.group),this.group=null);var e=this.good.color,t=this.good.length,o=this.good.width,i=this.good.height,n=t>o?t>i?t:i:o>i?o:i;t=t/n*50,o=o/n*50,i=i/n*50,this.group=new r["Group"];var s=new r["CubeGeometry"](o,i,t,0,0,0),a=new r["MeshPhongMaterial"]({color:e,side:r["DoubleSide"],flatShading:r["FlatShading"]}),l=new r["Mesh"](s,a),h=new r["Line"](s,new r["LineDashedMaterial"]({color:0}));this.group.add(l,h),this.group.position.x=0,this.group.position.y=0,this.group.position.z=0,this.scene.add(this.group)},changeRotation:function(){switch(this.good.restrictionflag){case"x-":this.group.rotation.x=0,this.group.rotation.y=0,this.group.rotation.z=0;break;case"x|":this.group.rotation.x=0,this.group.rotation.y=Math.PI/2,this.group.rotation.z=0;break;case"y-":this.group.rotation.x=0,this.group.rotation.y=0,this.group.rotation.z=Math.PI/2;break;case"y|":this.group.rotation.x=0,this.group.rotation.y=Math.PI/2,this.group.rotation.z=Math.PI/2;break;case"z-":this.group.rotation.x=Math.PI/2,this.group.rotation.y=0,this.group.rotation.z=0;break;case"z|":this.group.rotation.x=Math.PI/2,this.group.rotation.y=0,this.group.rotation.z=Math.PI/2;break}}}},w=b,v=Object(u["a"])(w,f,m,!1,null,null,null),x=v.exports,y=(o("99af"),o("13d5"),o("53ca"));function k(e){return Array.prototype.reduce.call(e,(function(e,t){var o=[];return e.forEach((function(e){t.forEach((function(t){o.push(e.concat([t]))}))})),o}),[[]])}function S(e){var t=[],o=[];function i(e){for(var n,s=0;s<e.length;s++)n=e.splice(s,1)[0],o.push(n),0==e.length&&t.push(o.slice()),i(e),e.splice(s,0,n),o.pop();return t}return i(e)}function z(e){var t=this;this.allGoods=[],this.resGoods=[],e.forEach((function(e){var o=[];e.restrictions.forEach((function(t){if(t.isselect){var i=e.length,n=e.width,s=e.height;switch(t.flag){case"x-":break;case"x|":i=e.width,n=e.length;break;case"y-":n=e.height,s=e.width;break;case"y|":s=e.width,n=e.length,i=e.height;break;case"z-":s=e.length,i=e.height;break;case"z|":s=e.length,n=e.height,i=e.width;break}var a={height:s,length:i,width:n,flag:t.flag,name:e.name,id:e.id,color:e.color,direction:t.direction,num:e.num,inout:e.inout?e.inout:0};o.push(a)}})),t.allGoods.push(o)})),this.resGoods=k(this.allGoods);var o=[];console.log(this.resGoods),this.resGoods.forEach((function(e){console.log(e);var t=S(e);t.forEach((function(e){for(var t=!0,i=0,n=0;n<e.length;n++){var s=e[n];i<=0||!s.inout||i>=s.inout||0==s.inout?i=s.inout:t=!1}t&&o.push(e)})),console.log(o),console.log("VV__")})),this.resGoods=o}function G(e){var t=this;this.index=-1,this.num=0,this.count=0,this.goods=e,this.realGoods=[],e.forEach((function(e){for(var o=0;o<e.num;o++){var i=C(e);i.index=o,t.realGoods.push(i)}e.count=e.num,t.num+=e.num,t.count=t.num})),this.next=function(){if(this.realGoods.length<this.index+1)return null;var e=this.realGoods[++this.index];return e}}function C(e){var t=e.constructor===Array?[]:{};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(e[o]&&"object"===Object(y["a"])(e[o])?(t[o]=e[o].constructor===Array?[]:{},t[o]=C(e[o])):t[o]=e[o]);return t}function _(e){e.otherbox=e.filter((function(e){return!e.isFalse}));var t=0;return e.forEach((function(e){t+=e.length*e.width*e.height})),t}function O(e,t){var o=new z(e),i={allcount:0,otherbox:[],otherboxBulk:null};return t.forEach((function(e){console.log("当前集装箱体积："+e.length*e.width*e.height),console.log(o.resGoods),o.resGoods.forEach((function(t){var o={allcount:0,otherbox:[]};o.box=e;var n=new G(t);$(n,e,null,o),o.goodsManager=n,o.otherboxBulk=_(o.otherbox);var s=!1;(null==i.otherboxBulk||i.otherboxBulk>o.otherboxBulk)&&(s=!0,i=C(o)),console.log("当前方法 剩余空间体积："+o.otherboxBulk+(s?" ----":""))}))})),i}function $(e,t,o,i){var n=e.next();if(null!=n){var s={};if(null==o){if(s={x:0,y:0,z:0},i.maxVal={length:n.length,width:n.width,height:n.height},s.x+n.width>t.width||s.y+n.height>t.height||s.z+n.length>t.length){var a={pos:s,height:t.height-s.y,length:t.length-s.z,width:t.width-s.x,type:"beyond_"};return void j(i.otherbox,a)}}else s={x:o.pos.x+(i.maxVal.width>o.width?i.maxVal.width:o.width),y:o.pos.y,z:o.pos.z};if(s.x+n.width>t.width){var l={pos:C(s),height:o.height,length:o.length,width:t.width-s.x,type:"beyond_width"};if(j(i.otherbox,l),s.x=0,s.y=o.pos.y+(i.maxVal.height>o.height?i.maxVal.height:o.height),i.maxVal.height=0,i.maxVal.width=0,s.y+n.height>t.height){var r={pos:C(s),height:t.height-s.y,length:o.length,width:t.width-s.x,type:"beyond_height"};if(j(i.otherbox,r),s.y=0,s.z=o.pos.z+(i.maxVal.length>o.length?i.maxVal.length:o.length),i.maxVal.length=0,s.z+n.length>t.length){var h={pos:s,height:t.height-s.y,length:t.length-s.z,width:t.width-s.x,type:"beyond"};return void j(i.otherbox,h)}}}n.length>i.maxVal.length&&(i.maxVal.length=n.length),n.width>i.maxVal.width&&(i.maxVal.width=n.width),n.height>i.maxVal.height&&(i.maxVal.height=n.height),n.pos=s,i.allcount++,$(e,t,n,i)}else{var c={x:o.pos.x+o.width,y:o.pos.y,z:o.pos.z},d={pos:c,height:t.height-c.y,length:t.length-c.z,width:t.width-c.x,type:"notnext_1"};j(i.otherbox,d);var u={x:0,y:o.pos.y+o.height,z:o.pos.z},g={pos:u,height:t.height-u.y,length:t.length-u.z,width:t.width-d.width-u.x,type:"notnext_2"};j(i.otherbox,g);var p={x:0,y:0,z:o.pos.z+o.length},f={pos:p,height:t.height-g.height,length:t.length-p.z,width:t.width-d.width,type:"notnext_3"};if(j(i.otherbox,f),0!=o.pos.y){var m={x:o.pos.x+o.width,y:0,z:o.pos.z+o.length},b={pos:m,height:t.height-d.height,length:t.length-m.z,width:t.width-f.width,type:"notnext_4"};j(i.otherbox,b)}}}function M(e,t){for(var o=0;o<e.length;o++){var i=e[o];i.isFalse||(i.length==t.length&&i.height==t.height&&i.width==t.width&&i.pos.x==t.pos.x&&i.pos.y==t.pos.y&&i.pos.z==t.pos.z||t.type==i.type&&(t.pos.x==i.pos.x&&t.pos.z==i.pos.z&&t.width==i.width&&t.length==i.length&&(i.height+=t.height,t.isFalse=!0,M(e,i)),t.pos.x==i.pos.x&&t.pos.y==i.pos.y&&t.height==i.height&&t.width==i.width&&(i.length+=t.length,t.isFalse=!0,M(e,i))))}}function j(e,t){if(0!=t.height&&0!=t.width&&0!=t.length){for(var o=0;o<e.length;o++){var i=e[o];i.isFalse||i.type==t.type&&(t.pos.x==i.pos.x&&t.pos.z==i.pos.z&&t.width==i.width&&t.length==i.length&&(i.height+=t.height,t.isFalse=!0,M(e,i)),t.pos.x==i.pos.x&&t.pos.y==i.pos.y&&t.height==i.height&&t.width==i.width&&(i.length+=t.length,t.isFalse=!0,M(e,i)))}t.isFalse||e.push(t)}}var D={name:"App",components:{maincanvas:p,goodcanvas:x},data:function(){return{drawer:!0,opt:{goods:[],boxes:[],goodsSel:[],boxesSel:[]},units:["克","千克","吨","磅"],hasSelect:!1,restrictions:[{flag:"x-",isselect:!0,direction:"立放,正向",isbear:!0,bearlevel:1,isstack:!0,stacklevel:1},{flag:"x|",isselect:!0,direction:"立放,横向",isbear:!0,bearlevel:1,isstack:!0,stacklevel:1},{flag:"y-",isselect:!0,direction:"侧放,正向",isbear:!0,bearlevel:1,isstack:!0,stacklevel:1},{flag:"y|",isselect:!0,direction:"侧放,横向",isbear:!0,bearlevel:1,isstack:!0,stacklevel:1},{flag:"z-",isselect:!0,direction:"卧放,正向",isbear:!0,bearlevel:1,isstack:!0,stacklevel:1},{flag:"z|",isselect:!0,direction:"卧放,横向",isbear:!0,bearlevel:1,isstack:!0,stacklevel:1}],dialog:{goodsshow:!1,goodform:{id:null,name:"",desc:"",netweight:0,grossweight:0,unit:"",stackinglevel:1,color:"",length:0,width:0,height:0,num:0,restrictions:[],restrictionflag:"",inout:0},goodformrules:{name:[{required:!0,message:"请输入",trigger:"blur"}],num:[{required:!0,message:"请输入",trigger:"blur"}],length:[{required:!0,message:"请输入",trigger:"blur"}],width:[{required:!0,message:"请输入",trigger:"blur"}],height:[{required:!0,message:"请输入",trigger:"blur"}]},tabval:"1",boxesshow:!1,boxform:{id:null,name:"",desc:"",length:0,width:0,height:0},boxformrules:{name:[{required:!0,message:"请输入",trigger:"blur"}],length:[{required:!0,message:"请输入",trigger:"blur"}],width:[{required:!0,message:"请输入",trigger:"blur"}],height:[{required:!0,message:"请输入",trigger:"blur"}]}},display:null}},created:function(){var e=this;this.$nextTick((function(){e.initOpt(),e.dialog.goodform.restrictions=e.restrictions}))},methods:{initOpt:function(){var e=localStorage.getItem("opt");null!=e&&(e=JSON.parse(e),this.opt=e)},saveOpt:function(){var e=C(this.opt);delete e.goodsSel,delete e.boxesSel,localStorage.setItem("opt",JSON.stringify(e))},goodsrowdbclick:function(e){this.dialog.goodform=C(e),this.dialog.tabval="1",this.dialog.goodsshow=!0},boxesrowdbclick:function(e){this.dialog.boxform=C(e),this.dialog.boxesshow=!0},showAddGoodsDialog:function(){this.dialog.goodform={id:null,name:"",desc:"",netweight:0,grossweight:0,unit:"",stackinglevel:1,color:"#"+Math.random().toString(16).slice(-6),length:200,width:400,height:600,num:100,restrictions:this.restrictions,restrictionflag:"",inout:0},this.dialog.tabval="1",this.dialog.goodsshow=!0},showAddboxesDialog:function(){this.dialog.boxform={id:null,name:"",desc:"",length:8e3,width:2e3,height:2e3},this.dialog.boxesshow=!0},handleCurrentChange:function(e){e&&(this.dialog.goodform.restrictionflag=e.flag)},saveGood:function(){var e=this;0!=this.dialog.goodform.restrictions.filter((function(e){return e.isselect})).length?this.$refs.goodform.validate((function(t){if(t){if(null==e.dialog.goodform.id)e.dialog.goodform.id=(new Date).getTime(),e.opt.goods.push(e.dialog.goodform);else{var o=!1;if(e.opt.goodsSel)for(var i=0;i<e.opt.goodsSel.length;i++){var n=e.opt.goodsSel[i];n.id==e.dialog.goodform.id&&(o=!0)}for(var s=0;s<e.opt.goods.length;s++){var a=e.opt.goods[s];a.id==e.dialog.goodform.id&&e.opt.goods.splice(s,1,e.dialog.goodform)}o&&e.$refs.goodstable.toggleRowSelection(e.dialog.goodform)}e.saveOpt(),e.dialog.goodsshow=!1}})):this.$message({showClose:!0,message:"至少选择一条摆放方式",type:"error"})},saveBox:function(){var e=this;this.$refs.boxform.validate((function(t){if(t){if(null==e.dialog.boxform.id)e.dialog.boxform.id=(new Date).getTime(),e.opt.boxes.push(e.dialog.boxform);else{var o=!1;if(e.opt.boxesSel)for(var i=0;i<e.opt.boxesSel.length;i++){var n=e.opt.boxesSel[i];n.id==e.dialog.boxform.id&&(o=!0)}for(var s=0;s<e.opt.boxes.length;s++){var a=e.opt.boxes[s];a.id==e.dialog.boxform.id&&e.opt.boxes.splice(s,1,e.dialog.boxform)}o&&e.$refs.boxestable.toggleRowSelection(e.dialog.boxform)}e.saveOpt(),e.dialog.boxesshow=!1}}))},boxesdel:function(e){var t=this,o=this.opt.boxes[e];this.opt.boxes.splice(e,1);var i=this.$createElement,n=this.$message({message:i("p",null,[i("div",null,"["+o.name+"]已删除"),i("el-button",{attrs:{type:"text"},class:"undo",on:{click:function(){t.opt.boxes.splice(e,0,o),t.saveOpt(),n.close()}}},"撤销")]),duration:5e3,showClose:!0});this.saveOpt()},goodsdel:function(e){var t=this,o=this.opt.goods[e];this.opt.goods.splice(e,1);var i=this.$createElement,n=this.$message({message:i("p",null,[i("div",null,"["+o.name+"]已删除"),i("el-button",{attrs:{type:"text"},class:"undo",on:{click:function(){t.opt.goods.splice(e,0,o),t.saveOpt(),n.close()}}},"撤销")]),duration:5e3,showClose:!0});this.saveOpt()},handleSelectionChange_boxes:function(e){this.opt.boxesSel=e,this.hasSelectHandle()},handleSelectionChange_goods:function(e){this.opt.goodsSel=e,this.hasSelectHandle()},hasSelectHandle:function(){this.opt.boxesSel&&this.opt.goodsSel&&this.opt.boxesSel.length>0&&this.opt.goodsSel.length>0?this.hasSelect=!0:this.hasSelect=!1},doitClick:function(){var e=O(this.opt.goodsSel,this.opt.boxesSel);this.display=e}}},I=D,P=(o("034f"),Object(u["a"])(I,n,s,!1,null,null,null)),E=P.exports,L=o("5c96"),V=o.n(L),F=(o("0fae"),o("a9f5")),B=o.n(F);i["default"].config.productionTip=!1,i["default"].use(V.a),i["default"].use(B.a),new i["default"]({render:function(e){return e(E)}}).$mount("#app")},"85ec":function(e,t,o){}});
//# sourceMappingURL=app.531b6e88.js.map